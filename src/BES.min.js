function BasylEncryptor(m){function x(a,d,e){for(var b=0;16>b;b++)e?h.push(a[b]):h.push(Math.floor(1E4*Math.random())%256);for(b=0;b<g;b++)c.push(b*b+b+h[b%16]);for(b=0;b<d.length;b++)c[b]+=d.charCodeAt(b);k=[];n=[];for(a=0;256>a;a++)k.push(a),n.push(a);for(b=p=0;20>b;b++)t(),3!=b&&9!=b&&13!=b||y(),u(),4!=b&&8!=b&&t();l=0;z(10);v()}function z(a){for(var d=0;d<a;d++)for(var e=0;256>e;e++)q(e),w(e),q(h[e%16])}function t(){for(var a=1;a<g;a++)c[a]+=c[a-1],c[a]%=913137}function A(a){var d=c[l++]%256,
e=k[d];n[e]=a;n[k[a]]=d;k[d]=k[a];k[a]=e}function B(a,d){a=Math.abs(a);return 0>=d?(p=a%g,c[p]):B(c[a%g]%g,d-1)}function y(){for(var a=0;a<g;a++){var d=c[a];B(c[a]%g,(d<<2^d>>2)%8+1);c[a]=c[p];c[p]=d}}function u(){for(var a=g-2;0<=a;a--)c[a]+=c[a+1],c[a]%=913122}function q(a){a=Math.abs(a)&255;var d=k[a];A(a);return d}function w(a){a=Math.abs(a)&255;a=n[a];A(a);return a}function v(){for(var a=l=0;a<r.length;a++)c[a]+=r.charCodeAt(a);t();u();y();u();z(2);l=0}m="undefined"!==typeof m?m:!1;var p=0,l=
0,c=null,h=null,g=null,r=null,k=null,n=null;this.encryptString=function(a,d,e,b,c){c="undefined"!==typeof c?c:!1;for(var g=[],h=0;h<a.length;h++)c?(g.push(a.charCodeAt(h)>>8&255),g.push(a.charCodeAt(h)&255)):g.push(a.charCodeAt(h));return this.encrypt(g,d,e,b)};this.encrypt=function(a,d,e,b){c=[];h=[];r=b;g=e;x(null,d,!1);d="undefined"!==typeof Buffer&&!m;b=null;b=d?new Buffer(16+a.length):[];for(var f=0;16>f;f++)d?b[f]=h[f]:b.push(h[f]);for(f=0;f<a.length;f++)l>=e&&v(),d?b[f+16]=q(a[f]):b.push(q(a[f]));
return b};this.decryptString=function(a,d,c,b,f){f="undefined"!==typeof f?f:!1;a=this.decrypt(a,d,c,b);d="";for(c=0;c<a.length;c++)d=f?d+String.fromCharCode(a[c++]<<8|a[c]):d+String.fromCharCode(a[c]);return d};this.decrypt=function(a,d,e,b){c=[];h=[];r=b;g=e;x(a,d,!0);result=(d="undefined"!==typeof Buffer&&!m)?new Buffer(a.length-16):[];for(b=16;b<a.length;b++)l>=e&&v(),d?result.push(w(a[b])):result[b-16]=w(a[b]);return result}}
"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports=BasylEncryptor);
